

TITLE="DDPS fnm status"
REPORT_TIME="`export LANG=en_UK.UTF-8; /bin/date +'%B %d, %Y at %H:%M:%S'`"

MY_STATUSFILE=/tmp/csv

cat ${MY_STATUSFILE} | (
cat << EOF
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<head>
<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf8">
<TITLE>$TITLE</TITLE>
<style TYPE="text/css">
.unistyle table { border-collapse: collapse; text-align: left; width: 100%; }
.unistyle {font: normal 12px/150% Arial, Helvetica, sans-serif; background: #fff; overflow: hidden; border: 1px solid #006699; -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px; }
.unistyle table td,
.unistyle table th { padding: 3px 10px; }
.unistyle table thead th {background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #006699), color-stop(1, #00557F) );background:-moz-linear-gradient( center top, #006699 5%, #00557F 100% );filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#006699', endColorstr='#00557F');background-color:#006699; color:#FFFFFF; font-size: 15px; font-weight: bold; border-left: 1px solid #0070A8; }.unistyle table thead th:first-child { border: none; }
.unistyle table tbody td { color: #00496B; border-left: 1px solid #E1EEF4;font-size: 12px;font-weight: normal; }
.unistyle table tbody .alt td { background: #E1EEF4; color: #00496B; }
.unistyle table tbody .bad td { background: #FFF8C6; color: #00496B; }
.unistyle table tbody td:first-child { border-left: none; }
.unistyle table tbody tr:last-child td { border-bottom: none; }
</style>
</head>
<body>
<table frame="VOID" cellspacing="1" cols="1" rules="NONE" border="1"><tbody><tr><td>
<h1>$TITLE</h1>
<div class="unistyle">
<table>
<thead><tr><th>FQDN</th><th>Status</th><th>Information</th></tr></thead>
<tbody>
EOF
        awk -F';' '
        BEGIN {
            ALT = 0 ;
        }
        {
            if ($2 != "ok")
            {
                print "<tr class=\"bad\"><td>" $1 "</td><td>" $2 "</td><td>" $3 "</td></tr>"
                if (ALT == 0)
                {
                    ALT = 1;
                }
                next
            }

            if (ALT == 0)
            {
                print "<tr><td>" $1 "</td><td>" $2 "</td><td>" $3 "</td></tr>"
                ALT = 1
                next
            }
            else
            {
                print "<tr class=\"alt\"><td>" $1 "</td><td>" $2 "</td><td>" $3 "</td></tr>"
                ALT = 0
                next
            }
        }
    '

    cat << EOF
</tbody>
</table>
</div>
</body></html>
EOF

